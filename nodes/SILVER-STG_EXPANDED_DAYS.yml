fileVersion: 1
id: 77888b25-868e-4bf1-a7e3-89361ec3a98f
name: STG_EXPANDED_DAYS
operation:
  config:
    insertStrategy: INSERT
    postSQL: ""
    preSQL: ""
    testsEnabled: true
    truncateBefore: true
  database: ""
  deployEnabled: true
  description: Daily snapshot of opportunities with expanded date ranges and user mappings
  isMultisource: false
  locationName: SILVER
  materializationType: table
  metadata:
    appliedNodeTests: []
    columns:
      - appliedColumnTests: {}
        columnReference:
          columnCounter: b3919c22-31b8-47bc-b7cc-1fbcf084b7f5
          stepCounter: 77888b25-868e-4bf1-a7e3-89361ec3a98f
        config: {}
        dataType: DATE
        description: ""
        name: DAY_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: b3919c22-31b8-47bc-b7cc-1fbcf084b7f5
                stepCounter: 77888b25-868e-4bf1-a7e3-89361ec3a98f
            transform: "\"DD\".\"DATE\""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: b9030bdb-c16e-4fad-aeac-7db407c3f8b8
          stepCounter: 77888b25-868e-4bf1-a7e3-89361ec3a98f
        config: {}
        dataType: VARCHAR
        description: ""
        name: SALES_TEAM_REPORTING
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 188c94a7-c536-46ba-8894-a9ae54e7576f
                stepCounter: 6649e624-0884-4ebc-b06d-d5f307a50d2a
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 7be07ae0-789d-49c9-a06b-443369d6d42b
          stepCounter: 77888b25-868e-4bf1-a7e3-89361ec3a98f
        config: {}
        dataType: VARCHAR
        description: ""
        name: ID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 69de1935-3494-4966-85cb-6bd97120ca8b
                stepCounter: 506564c7-6c6f-4c9a-a2f9-7488042ed08b
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 4fdc7227-7e91-469d-9206-18604c233f98
          stepCounter: 77888b25-868e-4bf1-a7e3-89361ec3a98f
        config: {}
        dataType: VARCHAR
        description: ""
        name: ACCOUNT_ID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 5ae3a5b3-0d35-4206-86d0-ab4fa98e36c5
                stepCounter: 506564c7-6c6f-4c9a-a2f9-7488042ed08b
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: caeb7901-d8fa-46bd-84c2-225ba7f2d4d9
          stepCounter: 77888b25-868e-4bf1-a7e3-89361ec3a98f
        config: {}
        dataType: TIMESTAMP
        description: ""
        name: CREATED_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: b5b4caec-da0b-43c1-99ca-c9ad32d59b58
                stepCounter: 506564c7-6c6f-4c9a-a2f9-7488042ed08b
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: d8f76518-c0bd-4ec0-9555-0b3f6f67ca9d
          stepCounter: 77888b25-868e-4bf1-a7e3-89361ec3a98f
        config: {}
        dataType: DATE
        description: ""
        name: CLOSE_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: e9234a93-ec52-40e1-8aef-8a8a45c97828
                stepCounter: 506564c7-6c6f-4c9a-a2f9-7488042ed08b
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 73b9d72f-fefe-4267-ba8e-ad8eb0ccfe53
          stepCounter: 77888b25-868e-4bf1-a7e3-89361ec3a98f
        config: {}
        dataType: VARCHAR
        description: ""
        name: NAME
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: ac7bdb83-acd9-4f4d-978a-6319b6340e54
                stepCounter: 506564c7-6c6f-4c9a-a2f9-7488042ed08b
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 06bbd7c3-8cf4-455b-8fbd-6c859cfa006e
          stepCounter: 77888b25-868e-4bf1-a7e3-89361ec3a98f
        config: {}
        dataType: NUMBER
        description: ""
        name: NET_NEW_ACV
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: ccde2528-7eb5-4e1c-a09b-5bdbba47ef89
                stepCounter: 506564c7-6c6f-4c9a-a2f9-7488042ed08b
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: ad4fcfd3-256b-47a2-955c-d263a485f884
          stepCounter: 77888b25-868e-4bf1-a7e3-89361ec3a98f
        config: {}
        dataType: VARCHAR
        description: ""
        name: STAGE_NAME
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 8b60606b-591f-41c1-bd52-8d8fd4605517
                stepCounter: 506564c7-6c6f-4c9a-a2f9-7488042ed08b
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 68052ffa-4b42-42c2-9cfc-d48a6c20a21f
          stepCounter: 77888b25-868e-4bf1-a7e3-89361ec3a98f
        config: {}
        dataType: VARCHAR
        description: ""
        name: OWNER_ID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 9da4d2e3-31a9-4aaa-b080-02d0f22663e0
                stepCounter: 506564c7-6c6f-4c9a-a2f9-7488042ed08b
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 77fe8bb7-af62-47a5-afde-07ffed461bdc
          stepCounter: 77888b25-868e-4bf1-a7e3-89361ec3a98f
        config: {}
        dataType: VARCHAR
        description: ""
        name: SALES_TEAM
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 17012a01-bf25-4914-8320-944595d4fb28
                stepCounter: 506564c7-6c6f-4c9a-a2f9-7488042ed08b
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: f82624c1-0239-49e7-aa03-d54ba0fb6a68
          stepCounter: 77888b25-868e-4bf1-a7e3-89361ec3a98f
        config: {}
        dataType: VARCHAR
        description: ""
        name: PRM_PARTNER_LEVEL
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: b0b0fbf3-6fe0-42d6-bdbf-72f2e05576de
                stepCounter: 506564c7-6c6f-4c9a-a2f9-7488042ed08b
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: ceff3c02-8520-4841-a739-801f8385a157
          stepCounter: 77888b25-868e-4bf1-a7e3-89361ec3a98f
        config: {}
        dataType: TIMESTAMP
        description: ""
        name: DBT_VALID_FROM
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 7e1aa0cd-68b6-42cd-90ee-34c17686ba33
                stepCounter: 506564c7-6c6f-4c9a-a2f9-7488042ed08b
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 7671dec6-edf3-41de-9a34-279cc46d13b3
          stepCounter: 77888b25-868e-4bf1-a7e3-89361ec3a98f
        config: {}
        dataType: TIMESTAMP
        description: ""
        name: DBT_VALID_TO
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: e6765efb-e81a-46ca-ad45-c95e699955c6
                stepCounter: 506564c7-6c6f-4c9a-a2f9-7488042ed08b
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: bf4e9026-a60e-49c0-ba71-5081253316b7
          stepCounter: 77888b25-868e-4bf1-a7e3-89361ec3a98f
        config: {}
        dataType: VARCHAR
        description: ""
        name: MULTI_YEAR_SUBSCRIPTION
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: f92b9435-41e5-4b56-9c95-e3ae89615794
                stepCounter: 3aef8309-4679-4b5e-a986-e3344555ebab
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 85b4e7a4-3304-496e-bc9a-415c0d8549a8
          stepCounter: 77888b25-868e-4bf1-a7e3-89361ec3a98f
        config: {}
        dataType: VARCHAR
        description: ""
        name: TERRITORY
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 17012a01-bf25-4914-8320-944595d4fb28
                stepCounter: 506564c7-6c6f-4c9a-a2f9-7488042ed08b
            transform: CASE WHEN "OPPORTUNITY_TIMESERIES"."SALES_TEAM" = 'Commercial Accounts' THEN "D_USER"."USER_ROLE" ELSE '' END
      - appliedColumnTests: {}
        columnReference:
          columnCounter: a62a3f5a-46df-4ad8-a1c9-f34477ecf867
          stepCounter: 77888b25-868e-4bf1-a7e3-89361ec3a98f
        config: {}
        dataType: VARCHAR
        description: ""
        name: PARTNER_TYPE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: b0b0fbf3-6fe0-42d6-bdbf-72f2e05576de
                stepCounter: 506564c7-6c6f-4c9a-a2f9-7488042ed08b
            transform: CASE WHEN "OPPORTUNITY_TIMESERIES"."PRM_PARTNER_LEVEL" = 'Alliance Partner' THEN 'Alliance Partner' WHEN "OPPORTUNITY_TIMESERIES"."PRM_PARTNER_LEVEL" = 'Referral Partner' THEN 'Referral Partner' WHEN "OPPORTUNITY_TIMESERIES"."PRM_PARTNER_LEVEL" = 'Solution Provider Partner' THEN 'Solution Provider Partner' WHEN "OPPORTUNITY_TIMESERIES"."PRM_PARTNER_LEVEL" IS NULL THEN 'N/A' ELSE "OPPORTUNITY_TIMESERIES"."PRM_PARTNER_LEVEL" END
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 0c3a7ec4-e068-4cb8-bba5-68855318d64f
          stepCounter: 77888b25-868e-4bf1-a7e3-89361ec3a98f
        config: {}
        dataType: VARCHAR
        description: ""
        name: OPPORTUNITY_OWNER
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 91396b28-3e88-4eac-81ff-e7450b73bcc0
                stepCounter: 16b54ae0-3f25-4fb3-b5ed-91fd7d090a0f
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 41756b5f-a3be-428b-ad7e-18876229ff84
          stepCounter: 77888b25-868e-4bf1-a7e3-89361ec3a98f
        config: {}
        dataType: VARCHAR
        description: ""
        name: SUB_TEAM
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: e3203611-dcf9-4d8b-84d7-fd24aaab6f24
                stepCounter: 16b54ae0-3f25-4fb3-b5ed-91fd7d090a0f
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: d9fac348-5c9e-44fa-8786-bda591c4edf8
          stepCounter: 77888b25-868e-4bf1-a7e3-89361ec3a98f
        config: {}
        dataType: VARCHAR
        description: ""
        name: USER_ROLE_ID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: e9c6da93-1e24-4f92-b6e7-e19f8f72b20b
                stepCounter: 16b54ae0-3f25-4fb3-b5ed-91fd7d090a0f
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 6a072526-3ee6-4fda-bbf7-67295dc63c6f
          stepCounter: 77888b25-868e-4bf1-a7e3-89361ec3a98f
        config: {}
        dataType: VARCHAR
        description: ""
        name: OWNER_ROLE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: a9bb5c82-7976-43c0-ae3b-be5ee5f5d879
                stepCounter: 16b54ae0-3f25-4fb3-b5ed-91fd7d090a0f
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: b1c1c5bc-57e2-4609-9651-2c28ba104076
          stepCounter: 77888b25-868e-4bf1-a7e3-89361ec3a98f
        config: {}
        dataType: TIMESTAMP
        description: ""
        name: VALID_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: e6765efb-e81a-46ca-ad45-c95e699955c6
                stepCounter: 506564c7-6c6f-4c9a-a2f9-7488042ed08b
            transform: COALESCE("OPPORTUNITY_TIMESERIES"."DBT_VALID_TO", DATEADD(SECOND,-1, CURRENT_DATE + 1))
    cteString: ""
    description: ""
    destinationName: ""
    enabledColumnTestIDs: []
    materializationOption: ""
    sourceMapping:
      - aliases:
          D_USER: 16b54ae0-3f25-4fb3-b5ed-91fd7d090a0f
          LKP_SALES_TEAM_MAPPING: 6649e624-0884-4ebc-b06d-d5f307a50d2a
          OPPORTUNITY_TIMESERIES: 506564c7-6c6f-4c9a-a2f9-7488042ed08b
          SALES_ORDER_HEADER: 3aef8309-4679-4b5e-a986-e3344555ebab
        customSQL:
          customSQL: ""
        dependencies:
          - locationName: BRONZE
            nodeName: D_USER
          - locationName: BRONZE
            nodeName: DIM_DATE
          - locationName: BRONZE
            nodeName: LKP_SALES_TEAM_MAPPING
          - locationName: BRONZE
            nodeName: OPPORTUNITY_TIMESERIES
          - locationName: BRONZE
            nodeName: SALES_ORDER_HEADER
        join:
          joinCondition: |-
            FROM {{ ref('BRONZE', 'OPPORTUNITY_TIMESERIES') }} "OPPORTUNITY_TIMESERIES"
            JOIN (
                SELECT DISTINCT "DATE"
                FROM {{ ref('BRONZE', 'DIM_DATE') }} "DIM_DATE"
                WHERE "DATE" BETWEEN '2021-01-01' AND CURRENT_DATE
            ) "DD" ON "DD"."DATE" BETWEEN
                CAST(CONVERT_TIMEZONE('UTC','America/Los_Angeles',"OPPORTUNITY_TIMESERIES"."DBT_VALID_FROM") AS DATE)
                AND CAST(CONVERT_TIMEZONE('UTC','America/Los_Angeles',
                                          COALESCE("OPPORTUNITY_TIMESERIES"."DBT_VALID_TO",'9999-12-31')) AS DATE)
            LEFT JOIN {{ ref('BRONZE', 'D_USER') }} "D_USER" ON "OPPORTUNITY_TIMESERIES"."OWNER_ID" = "D_USER"."USER_ID"
            LEFT JOIN {{ ref('BRONZE', 'LKP_SALES_TEAM_MAPPING') }} "LKP_SALES_TEAM_MAPPING" ON "OPPORTUNITY_TIMESERIES"."SALES_TEAM" = "LKP_SALES_TEAM_MAPPING"."SALES_TEAM"
            LEFT JOIN {{ ref('BRONZE', 'SALES_ORDER_HEADER') }} "SALES_ORDER_HEADER" ON "OPPORTUNITY_TIMESERIES"."NETSUITE_SALES_ORDER_ID" = "SALES_ORDER_HEADER"."ID"
        name: STG_NODE
        noLinkRefs: []
  name: STG_EXPANDED_DAYS
  overrideSQL: false
  schema: ""
  sqlType: Stage
  type: sql
  version: 1
type: Node
